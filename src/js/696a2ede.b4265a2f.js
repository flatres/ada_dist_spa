(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["696a2ede"],{"08e9":function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-page",{staticClass:"no-scroll"},[n("q-toolbar",{staticClass:"text-white bg-toolbar shadow-2 rounded-borders narrowx justify",class:{"text-white":t.bg-t.dark},attrs:{dense:"",shrink:""}},[n("q-tabs",{attrs:{dense:"",shrink:"","active-color":(t.isLight,"primary")},model:{value:t.selectedTab,callback:function(e){t.selectedTab=e},expression:"selectedTab"}},t._l(t.elements,function(e){return n("div",{key:e.name},[e.menu?t._e():n("q-tab",{attrs:{label:e.label,name:e.name}}),e.menu?n("q-btn",{directives:[{name:"hotkey",rawName:"v-hotkey",value:{"shift+a":function(){t.selectedTab="bookings"}},expression:"{'shift+a': () => { selectedTab = 'bookings' }}"}],attrs:{flat:"",label:"Admin",icon:"fal fa-caret-down","text-color":t.isDark?"white":"primary"},nativeOn:{click:function(n){n.stopPropagation(),t.selectedTab=e.name}}},[n("q-menu",{ref:"settingsPopover",refInFor:!0,attrs:{"content-class":"bg-grey-9 text-white","auto-close":""}},[n("q-list",{attrs:{"item-separator":"",link:"","content-class":"bg-primary"}},t._l(e.menu,function(e){return n("q-item",{key:e.name,attrs:{clickable:""},nativeOn:{click:function(n){t.selectedTab=e.name}}},[n("q-item-section",{attrs:{avatar:"",left:"",dark:""}},[n("q-icon",{attrs:{name:e.icon+" fa-sm"}})],1),n("q-item-section",[n("q-item-label",[t._v(t._s(e.label))])],1)],1)}),1)],1)],1):t._e()],1)}),0),n("q-space"),t._t("side")],2),n("q-tab-panels",{model:{value:t.selectedTab,callback:function(e){t.selectedTab=e},expression:"selectedTab"}},t._l(t.tabPanels,function(e){return n("q-tab-panel",{key:e.name,attrs:{name:e.name}},[n(e.component,{tag:"component",on:{close:function(e){t.selectedTab=null}}})],1)}),1)],1)},a=[],o=(n("c880"),n("c03b")),i=n.n(o),l=n("9ce4"),c={name:"ComponentPageToolbar",props:{default:null,elements:null},watch:{selectedTab:function(){console.log(":",this.selectedTab)}},data:function(){return{selectedTab:null}},computed:i()({},Object(l["e"])("user",["isDark","isLight"]),{tabPanels:function(){var t=[];return this.elements.forEach(function(e){e.menu?e.menu.forEach(function(e){t.push({name:e.name,component:e.component})}):t.push({name:e.name,component:e.component})}),t}}),created:function(){this.selectedTab=this.default}},r=c,u=n("2be6"),d=Object(u["a"])(r,s,a,!1,null,null,null);e["a"]=d.exports},"2d07":function(t,e,n){"use strict";var s=n("4778");e["a"]={getNames:function(t,e){s["a"].get("/students/lists/names").then(function(e){t(e.data)}).catch(function(t){console.log(t)})},getHouses:function(t,e){s["a"].get("/students/houses").then(function(e){t(e.data)}).catch(function(t){console.log(t)})},getDetails:function(t,e,n){s["a"].get("/students/details/"+n.id).then(function(e){t(e.data)}).catch(function(t){console.log(t)})},getTags:function(t,e){s["a"].get("/students/tags").then(function(e){t(e.data)}).catch(function(t){console.log(t)})}}},"69f2":function(t,e,n){},"829b":function(t,e,n){},"8ab1":function(t,e,n){"use strict";var s=n("69f2"),a=n.n(s);a.a},"8ed6":function(t,e,n){"use strict";var s=n("df1f"),a=n.n(s);a.a},9550:function(t,e,n){"use strict";var s=n("829b"),a=n.n(s);a.a},df1f:function(t,e,n){},e1b0:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("toolbar-page",{attrs:{elements:t.elements,default:"bookings"}})},a=[],o=n("08e9"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"q-ma-md block full-height"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col",staticStyle:{"border-right":"1px solid #293557"}},[n("crud",{ref:"crud",attrs:{columns:t.columns,api:t.api,search:"",filter:"",canDelete:"",canNew:"",canEdit:"",inlineEdit:"",newComponent:t.newComponent}})],1),n("div",{staticClass:"col-5 full-height no-border"},[n("q-tabs",{staticClass:"narrow shadow-1 full-height no-border no-shadow",attrs:{animated:"",swipeable:"",align:"justify","underline-color":"primary"}},[n("q-tab",{attrs:{slot:"title",default:"",name:"cancel",iconx:"fas fa-ban",label:"Cancelled"},slot:"title"}),n("q-tab",{attrs:{slot:"title",name:"coaches",iconx:"fas fa-bus",label:"Coaches"},slot:"title"}),n("q-tab",{attrs:{slot:"title",name:"accounts",iconx:"far fa-file-excel",label:"Accounts"},slot:"title"})],1)],1)])])},l=[],c=(n("c880"),n("288e"),n("c03b")),r=n.n(c),u=n("d612"),d=n("4778"),f={getBookings:function(t,e,n){d["a"].get("/transport/coaches/bookings/"+n.sessionID).then(function(e){t(e.data)}).catch(function(t){console.log(t)})},getCoaches:function(t,e,n){d["a"].get("/transport/coaches").then(function(e){t(e.data)}).catch(function(t){console.log(t)})},cancelBookings:function(t,e,n){d["a"].post("/transport/coaches/bookings/cancel",t).then(function(t){e(t.data)}).catch(function(t){console.log(t),n()})},changeBusOut:function(t,e,n){var s={};s.id=t,s.txtBusOut=e,d["a"].put("/transport/coaches/bookings/changebusout",s).then(function(t){n()}).catch(function(t){console.log(t)})},changeBusReturn:function(t,e,n){var s={};s.id=t,s.txtBusRet=e,d["a"].put("/transport/coaches/bookings/changebusreturn",s).then(function(t){n()}).catch(function(t){console.log(t)})},getBusSummaries:function(t,e,n){d["a"].get("/transport/coaches/bookings/bussummaries/"+t).then(function(t){e(t.data)}).catch(function(t){console.log(t)})}},m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-table",{staticClass:"full-height no-border no-shadow",staticStyle:{"min-widthx":"800px","min-height":"710px"},attrs:{data:t.busSummaries,columns:t.columns,separator:t.separator,"row-key":t.code,pagination:t.paginationControl,color:"primary","hide-header":"",dark:t.isDark,dense:""},on:{"update:pagination":function(e){t.paginationControl=e}},scopedSlots:t._u([{key:"top-right",fn:function(e){return[n("q-btn",{staticClass:"q-mr-lg",attrs:{color:0===t.filterOut.length&&0===t.filterRet.length?"dark":"primary",label:"Clear Filters",disabled:0===t.filterOut.length&&0===t.filterRet.length,icon:"visibility",size:"xs"},on:{click:t.clearFilters}})]}},{key:"body",fn:function(e){return[n("q-tr",{attrs:{props:e}},[n("q-td",{key:"id",attrs:{props:e}},[n("q-checkbox",{staticClass:"q-mr-md",attrs:{color:"primary","checked-icon":"remove","unchecked-icon":"add"},model:{value:e.expand,callback:function(n){t.$set(e,"expand",n)},expression:"props.expand"}}),t._v("\n      "+t._s(e.row.id)+"\n    ")],1),n("q-td",{key:"code",attrs:{props:e}},[t._v(t._s(e.row.txtBusCode))]),n("q-td",{key:"destination",attrs:{props:e}},[t._v(t._s(e.row.txtDestination))]),n("q-td",{key:"countOut",staticClass:"text-justify",attrs:{props:e}},[n("q-checkbox",{staticClass:"q-mr-sm q-ml-xs",attrs:{dark:"",disable:0==e.row.countOut,val:e.row.txtBusCode,"checked-icon":"visibility","unchecked-icon":"visibility"},on:{input:t.setCoachOutFilter},model:{value:t.filterOut,callback:function(e){t.filterOut=e},expression:"filterOut"}}),t._v("\n      "+t._s(e.row.countOut)+"\n    ")],1),n("q-td",{key:"countRet",staticClass:"text-justify",attrs:{props:e}},[n("q-checkbox",{staticClass:"q-mr-sm q-ml-xs",attrs:{dark:"",disable:0==e.row.countRet,val:e.row.txtBusCode,"checked-icon":"visibility","unchecked-icon":"visibility"},on:{input:t.setCoachRetFilter},model:{value:t.filterRet,callback:function(e){t.filterRet=e},expression:"filterRet"}}),t._v("\n      "+t._s(e.row.countRet)+"\n    ")],1)],1),n("q-tr",{directives:[{name:"show",rawName:"v-show",value:e.expand,expression:"props.expand"}],attrs:{props:e}},[n("q-td",{attrs:{colspan:"100%"}},[n("div",{staticClass:"text-left"},[n("q-tabs",{attrs:{color:"#191919","underline-color":"primary"}},[n("q-tab",{attrs:{slot:"title",default:"",name:"details",label:"Details"},slot:"title"}),n("q-tab",{attrs:{slot:"title",name:"out",label:"Out"},slot:"title"}),n("q-tab",{attrs:{slot:"title",name:"ret",label:"Ret"},slot:"title"}),n("q-tab-panel",{attrs:{name:"details"}},[t._v("Tab One")]),n("q-tab-panel",{attrs:{name:"out"}},[t._v("Tab Two")]),n("q-tab-panel",{attrs:{name:"ret"}},[t._v("Tab Three")])],1)],1)])],1)]}}])})},h=[],b=n("9ce4"),p={name:"ComponentTransportCoachesDetails",props:{busSummaries:{type:Array}},data:function(){return{columns:[{name:"id",label:"#",field:"id",align:"left"},{name:"code",label:"Code",field:"txtBusCode"},{name:"destination",label:"Destination",field:"txtDestination"},{name:"countOut",label:"Bookings Out",field:"countOut"},{name:"countRet",label:"Bookings Ret",field:"countRet"}],paginationControl:{rowsPerPage:40,page:1,sortBy:"txtBusCode"},separator:"horizontal",filterOut:[],filterRet:[]}},methods:r()({},Object(b["d"])("transport",["setCoachOutFilter","setCoachRetFilter"]),{clearFilters:function(){this.filterRet=[],this.filterOut=[],this.setCoachOutFilter([]),this.setCoachRetFilter([])}}),computed:r()({},Object(b["c"])("transport",["coachOutFilter","coachRetFilter"]),Object(b["e"])("users",["isDark"])),components:{},created:function(){},watch:{busSummaries:function(){console.log(this.busSummaries)}}},g=p,k=(n("9550"),n("2be6")),v=Object(k["a"])(g,m,h,!1,null,"5eb6594c",null),C=v.exports,x=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"column",staticStyle:{"min-width":"400px"}},[n("q-select",{ref:"name",staticClass:"q-ml-sm full-width",staticStyle:{width:"200px","margin-left":"30px","margin-right":"30px"},attrs:{filter:"","use-input":"","input-debounce":"0",options:t.studentOptions,label:"Select Student",color:"white",dark:"",clearable:"","xpopup-content-class":"bg-dark text-white"},on:{input:t.studentDetails,filter:t.studentsFilterFn},model:{value:t.selectedStudent,callback:function(e){t.selectedStudent=e},expression:"selectedStudent"}}),n("div",{staticClass:"row q-mt-md",staticStyle:{"min-height":"25px"}},[t.selectedStudent&&t.studentHouse?n("q-chip",{attrs:{dense:"",color:"blue","text-color":"white",iconx:"alarm",label:t.studentHouse}}):t._e(),t.selectedStudent&&t.studentYear?n("q-chip",{attrs:{dense:"",color:"green","text-color":"white",iconx:"alarm",label:t.studentYear}}):t._e()],1),n("q-select",{staticClass:"q-mt-sm",attrs:{label:"Outward Bus",options:t.busOutOptions,dark:""},model:{value:t.busOut,callback:function(e){t.busOut=e},expression:"busOut"}}),n("q-select",{staticClass:"q-mt-lg",attrs:{label:"Return Bus",options:t.busRetOptions,dark:""},model:{value:t.busRet,callback:function(e){t.busRet=e},expression:"busRet"}}),n("q-btn",{staticClass:"q-mt-lg bg",attrs:{color:"primary",outline:"","vx-close-overlay":"",label:"Book"}}),n("q-btn",{staticClass:"q-mt-lg",attrs:{color:"secondary",outline:"",label:"Cancel"},on:{click:t.close}})],1)])},O=[],w=n("2d07"),q={name:"ComponentTransportCoachesNewBooking",props:["sessionName","coaches","bookings"],data:function(){return{selectedStudent:null,studentOptions:[],studentHouse:"C1",studentYear:"Shell",names:[],busOut:null,busRet:null,options:[],busOutOptions:[],busRetOptions:[]}},methods:{close:function(){this.$emit("close")},studentsFilterFn:function(t,e){var n=this;e(""!==t?function(){var e=t.toLowerCase();n.studentOptions=n.names.filter(function(t){return t.label.toLowerCase().indexOf(e)>-1})}:function(){n.studentOptions=n.names})},studentDetails:function(){var t=this;this.selectedStudent?w["a"].getDetails(function(e){t.studentHouse=e.boardingHouse,t.studentYear=e.gender},null,{id:this.selectedStudent.value}):(this.studentHouse=null,this.studentYear=null)}},computed:r()({},Object(b["e"])("user",["isDark"]),Object(b["c"])("transport",["activeSession"])),watch:{},components:{},created:function(){var t=this;w["a"].getNames(function(e){var n=e.map(function(t){return{label:t.lastname+", "+t.firstname,value:t.id}});t.names=n,t.studentOptions=n,console.log(t.studentOptions)})},mounted:function(){var t=this;f.getCoaches(function(e){var n=e.map(function(t){return{label:t.txtBusCode,value:t.txtBusCode}});t.busRetOptions=n,t.busOutOptions=n}),this.$refs.name.focus()}},y=q,S=(n("8ed6"),Object(k["a"])(y,x,O,!1,null,"4675627c",null)),B=S.exports,R=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-table",{staticClass:"full-height no-border no-shadow",staticStyle:{"min-widthx":"800px","min-height":"710px"},attrs:{data:t.bookingsCancelled,columns:t.columns,filter:t.filter,separator:t.separator,pagination:t.paginationControl,"row-key":t.id,selection:"multiple",selected:t.selectedRows,color:"primary","hide-header":"",dark:t.isDark,dense:""},on:{"update:pagination":function(e){t.paginationControl=e},"update:selected":function(e){t.selectedRows=e}},scopedSlots:t._u([{key:"top-left",fn:function(e){return[n("q-input",{staticClass:"col-6",attrs:{type:"search","hide-underline":"",color:"secondary",dark:t.isDark},model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}})]}},{key:"top-selection",fn:function(t){}},{key:"top-right",fn:function(e){return[n("q-table-columns",{staticClass:"q-mr-sm text-white",staticStyle:{color:"white"},attrs:{color:"white",dark:t.isDark,columns:t.columns},model:{value:t.visibleColumns,callback:function(e){t.visibleColumns=e},expression:"visibleColumns"}}),n("q-btn",{staticClass:"q-mr-xs",attrs:{color:"green",label:"cancel",round:"",icon:"add",size:"xs"},on:{click:t.cancel}})]}}])})},_=[],F={name:"ComponentTransportCoachesCancelled",props:{bookingsCancelled:{type:Array}},data:function(){return{paginationControl:{rowsPerPage:40,page:1,sortBy:"txtBusCode"},separator:"horizontal",columns:[{name:"lastName",required:!0,label:"Name",align:"left",field:"lastName",sortable:!0},{name:"firstName",required:!0,label:"",align:"left",field:"firstName",sortable:!0},{name:"gender",label:"M/F",field:"gender",sortable:!0},{name:"house",label:"Hs",field:"boarding",sortable:!0},{name:"busOut",label:"Bus Out",field:"txtBusOut",sortable:!0},{name:"busRet",label:"Bus Return",field:"txtBusRet",sortable:!0,align:"center"}]}},methods:{},computed:r()({},Object(b["e"])("user",["isDark"])),components:{},created:function(){}},T=F,D=(n("8ab1"),Object(k["a"])(T,R,_,!1,null,"6d77083c",null)),j=D.exports,N={name:"PageTransportExplorer",data:function(){return{newComponent:B,api:{get:f.getBookings,parameters:{sessionID:0},put:f.getBookings},coaches:[],coachesSelect:[],bookingsAll:[],filter:"",loading:!1,separator:"horizontal",busSummaries:[],pagination:{page:1},paginationControl:{rowsPerPage:40,page:1,sortBy:"lastName"},dark:!0,columns:[{name:"id",label:"id",field:"id",type:"string",align:"left",hidden:!0},{name:"lastName",required:!0,label:"Name",align:"left",field:"lastName",sortable:!0},{name:"firstName",required:!0,label:"",align:"left",field:"firstName",sortable:!0},{name:"gender",label:"M/F",field:"gender",sortable:!0,align:"left"},{name:"house",label:"Hs",field:"boarding",sortable:!0,align:"left"},{name:"busOut",label:"Bus Out",field:"txtBusOut",sortable:!0,type:"options",options:[],editable:!0,filter:!0},{name:"busRet",label:"Bus Return",field:"txtBusRet",sortable:!0,type:"options",options:[],editable:!0,filter:!0}],filterCoachOut:"",newModalOpen:!1}},computed:r()({},Object(b["c"])("transport",["activeSession","coachOutFilter","coachRetFilter"]),Object(b["e"])("user",["isDark"]),{bookings:function(){var t=this,e=this.bookingsAll.filter(function(t,e){return"0"===t.boolCancelled});return 0===this.coachOutFilter.length&&0===this.coachRetFilter.length?e:e.filter(function(e,n){return t.coachOutFilter.find(function(t){return t===e.txtBusOut})||t.coachRetFilter.find(function(t){return t===e.txtBusRet})})},bookingsCancelled:function(){var t=this.bookingsAll.filter(function(t,e){return"1"===t.boolCancelled});return t}}),methods:r()({},Object(b["d"])("transport",["setCoachOutFilter","setCoachRetFilter"]),{setSession:function(){this.api.parameters.sessionID=this.activeSession,this.$refs.crud.get(),this.loading=!0},setOptions:function(){var t=this;f.getCoaches(function(e){var n=e.map(function(t){return{label:t.txtBusCode,value:t.txtBusCode}});t.columns.find(function(t){return"busOut"===t.name}).options=n,t.columns.find(function(t){return"busRet"===t.name}).options=n,console.log(t.columns)})},loadSession:function(t){this.bookingsAll=t.bookings,this.coaches=t.coaches,this.coachesSelect=t.coachesSelect,this.loading=!1},loadBusSummaries:function(t){this.busSummaries=t},cancel:function(t){var e=this,n=this.selectedRows.length;0!==n&&this.$q.dialog({title:"Confirm",message:"Cancel ".concat(n," Bookings "),ok:"Agree",cancel:"Disagree"}).then(function(){e.loading=!0,f.cancelBookings(e.selectedRows,e.cancelComplete,e.cancelError)}).catch(function(){})},cancelComplete:function(t){var e=t.length,n=this.bookingsAll;t.forEach(function(t,e){var s=n.find(function(e){return e.id===t.id});s&&(s.boolCancelled="1")}),this.selectedRows=[],this.$q.notify("".concat(e," Bookings Cancelled")),this.loading=!1,this.busSummariesShow()},cancelError:function(){this.$q.notify("Something Went Wrong")},changeBusOut:function(t,e){f.changeBusOut(t,e,this.busSummariesShow)},changeBusRet:function(t,e){f.changeBusReturn(t,e,this.busSummariesShow)},busSummariesShow:function(){if(this.bookings.length>0)return f.getBusSummaries(this.activeSession,this.loadBusSummaries),!0}}),watch:{},components:{coachDetails:C,cancelled:j,newBooking:B,Crud:u["a"]},mounted:function(){var t=this;this.api.parameters={sessionID:this.activeSession},this.setCoachOutFilter([]),this.setCoachRetFilter([]),this.$store.watch(function(){return t.$store.getters["transport/activeSession"]},this.setSession),this.setSession(),this.setOptions()},created:function(){console.log("here",this.$store.getters["transport/activeSession"])}},$=N,E=Object(k["a"])($,i,l,!1,null,null,null),P=E.exports,A={name:"PageTransportCoaches",data:function(){return{elements:[{name:"bookings",label:"Bookings",component:P,shortcut:"b"},{name:"setup",label:"setup",shortcut:"s"}]}},components:{toolbarPage:o["a"]}},H=A,z=Object(k["a"])(H,s,a,!1,null,null,null);e["default"]=z.exports}}]);