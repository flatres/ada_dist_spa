(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["ad55165a"],{"00ed":function(t,e,s){"use strict";var o=s("891c"),i=s.n(o);i.a},1853:function(t,e,s){},"2df7":function(t,e,s){},3670:function(t,e,s){},"392f":function(t,e,s){},"3bde":function(t,e,s){"use strict";var o=s("2df7"),i=s.n(o);i.a},4017:function(t,e,s){"use strict";var o=s("b07e"),i=s.n(o);i.a},"44d9":function(t,e,s){},"5c47":function(t,e,s){"use strict";var o=s("8926"),i=s.n(o);i.a},"63c7":function(t,e,s){"use strict";var o=s("44d9"),i=s.n(o);i.a},"6eae":function(t,e,s){},8209:function(t,e,s){"use strict";var o=s("3670"),i=s.n(o);i.a},"891c":function(t,e,s){},8926:function(t,e,s){},ad84:function(t,e,s){},b07e:function(t,e,s){},bd0e:function(t,e,s){"use strict";var o=s("6eae"),i=s.n(o);i.a},c1e0:function(t,e,s){"use strict";var o=s("ad84"),i=s.n(o);i.a},e1b0:function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("toolbar-page",{attrs:{elements:t.elements,default:"home"}})},i=[],n=(s("c880"),s("288e"),s("08e9")),a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"row q-mb-md"},[s("q-input",{staticClass:"row full-width",attrs:{label:"Search",dark:"",autofocus:""},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),s("div",{staticClass:"row q-gutter-xs"},[s("div",{staticClass:"col bg-toolbar"},[s("q-bar",{staticClass:"bg-primary",attrs:{dense:""}},[s("div",{staticClass:"text-black"},[t._v("New")]),s("q-space"),t.newBookings.length>0?s("q-badge",{attrs:{color:"blue-9"}},[t._v("\n          "+t._s(t.newBookings.length)+"\n        ")]):t._e()],1),s("q-scroll-area",{staticStyle:{height:"80vh"},attrs:{visible:""}},[s("q-list",{staticClass:"no-padding"},t._l(t.newBookings,(function(e){return s("booking-card",{key:e.id,staticClass:"q-pa-xs text-white bg-grey-9 q-my-sm",attrs:{group:"new",dense:"",booking:e,stops:t.stops,routes:t.routes},on:{change:t.getBookings}})})),1)],1)],1),s("div",{staticClass:"col-3 bg-toolbar"},[s("q-bar",{staticClass:"bg-orange",attrs:{dense:""}},[s("div",[t._v("Pending")]),s("q-space")],1),s("q-scroll-area",{staticStyle:{height:"80vh"},attrs:{visible:""}},[s("q-list",{staticClass:"no-padding"},t._l(t.pendingBookings,(function(e){return s("booking-card",{key:e.id,staticClass:"q-pa-xs text-white bg-grey-9 q-my-sm",attrs:{group:"pending",dense:"",booking:e,stops:t.stops,routes:t.routes},on:{change:t.getBookings}})})),1)],1)],1),s("div",{staticClass:"col-3 bg-toolbar"},[s("q-bar",{staticClass:"bg-light-green-5",attrs:{dense:""}},[s("div",[t._v("Confirmed To Parents")]),s("q-space")],1),s("q-scroll-area",{staticStyle:{height:"80vh"},attrs:{visible:""}},[s("q-list",{staticClass:"no-padding"},t._l(t.confirmedBookings,(function(e){return s("booking-card",{key:e.id,staticClass:"q-pa-xs text-white bg-grey-9 q-my-sm",attrs:{group:"confirmed",dense:"",booking:e,stops:t.stops,routes:t.routes},on:{change:t.getBookings}})})),1)],1)],1),s("div",{staticClass:"col-2 bg-toolbar row"},[s("div",{staticClass:"full-width column wrap justify-start items-start content-start"},[s("div",{staticStyle:{overflow:"auto","min-width":"100%","max-width":"100%"}},[s("q-bar",{staticClass:"bg-red-14",attrs:{dense:""}},[s("div",[t._v("Cancelled")]),s("q-space")],1),s("q-scroll-area",{staticStyle:{height:"40vh"},attrs:{visible:""}},[s("q-list",{staticClass:"no-padding"},t._l(t.cancelledBookings,(function(e){return s("booking-card",{key:e.id,staticClass:"q-pa-xs text-white bg-grey-9 q-my-sm",attrs:{group:"cancelled",dense:"",booking:e,stops:t.stops,routes:t.routes}})})),1)],1)],1),t.declinedBookings.length>0?s("div",{staticStyle:{overflow:"auto","min-width":"100%","max-width":"100%"}},[s("q-bar",{staticClass:"bg-blue-14 text-white",attrs:{dense:""}},[s("div",[t._v("Declined")]),s("q-space")],1),s("q-scroll-area",{staticStyle:{height:"40vh"},attrs:{visible:""}},[s("q-list",{staticClass:"no-padding"},t._l(t.declinedBookings,(function(e){return s("booking-card",{key:e.id,staticClass:"q-pa-xs text-white bg-grey-9 q-my-sm",attrs:{group:"declined",dense:"",booking:e,stops:t.stops,routes:t.routes}})})),1)],1)],1):t._e()])])])])},r=[],l=(s("06ef"),s("4778")),c=s("452d"),u={putBooking:function(t,e,s){l["a"].put("/transport/coaches/bookings",s).then((function(e){t(e.data)})).catch((function(t){console.log(t),e()}))},postBooking:function(t,e,s){l["a"].post("/transport/coaches/bookings",s).then((function(e){t(e.data)})).catch((function(t){console.log(t),e()}))},deleteBooking:function(t,e,s){l["a"].delete("/transport/coaches/bookings/"+s).then((function(e){t(e.data)})).catch((function(t){console.log(t)}))},declineBooking:function(t,e,s){l["a"].delete("/transport/coaches/bookings/decline/"+s).then((function(e){t(e.data)})).catch((function(t){console.log(t)}))},getAllBookings:function(t,e,s){var o=c["a"].getters["transport/activeSession"];l["a"].get("/transport/coaches/bookings/"+o).then((function(e){t(e.data)})).catch((function(t){console.log(t)}))},getNewCount:function(t,e){var s=c["a"].getters["transport/activeSession"];l["a"].get("/transport/coaches/newbookings/"+s).then((function(e){t(e.data)})).catch((function(t){console.log(t)}))},putCoachAssignment:function(t,e,s){l["a"].put("/transport/coaches/assignment",s).then((function(e){t(e.data)})).catch((function(t){console.log(t),e()}))},putConfirmBooking:function(t,e,s){l["a"].put("/transport/coaches/confirm",s).then((function(e){t(e.data)})).catch((function(t){console.log(t),e()}))}},d=s("5228"),p=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"col",staticStyle:{"min-width":"500px","min-height":"50vh"}},[s("div",{staticClass:"col-12"},[s("q-select",{ref:"name",attrs:{"map-options":"",dense:"",autofocus:"",clearable:"",outlined:"",options:t.pupilOptions,label:"Pupil Name","content-class":"bg-dark",dark:"","use-input":"","input-debounce":"0",readonly:t.isEdit},on:{change:function(e){return t.pupilDetails(t.selectedPupil)},input:function(e){return t.pupilDetails(t.selectedPupil)},filter:t.pupilFilter},model:{value:t.selectedPupil,callback:function(e){t.selectedPupil=e},expression:"selectedPupil"}}),t.pupilHouse?s("q-chip",{attrs:{dense:"",icon:"home",size:"10px"}},[t._v(t._s(t.pupilHouse))]):t._e(),t.pupilEmail?s("q-chip",{attrs:{dense:"",icon:"mail",size:"10px"}},[t._v(t._s(t.pupilEmail))]):t._e()],1),s("br"),s("q-tabs",{staticClass:"bg-grey-8 text-primary",attrs:{dense:""},model:{value:t.journeyTab,callback:function(e){t.journeyTab=e},expression:"journeyTab"}},[t.isRetOnly?t._e():s("q-tab",{attrs:{name:"out",label:"Outbound"}}),t.isOutOnly?t._e():s("q-tab",{attrs:{name:"ret",label:"Return"}})],1),s("q-tab-panels",{attrs:{animated:""},model:{value:t.journeyTab,callback:function(e){t.journeyTab=e},expression:"journeyTab"}},[s("q-tab-panel",{staticClass:"bg-secondar q-px-xs",attrs:{name:"out"}},[s("h1",{staticClass:"q-mx-none q-pa-xs fullwidth bgx-grey-8"},[t._v("Destination")]),s("q-select",{ref:"stopOut",attrs:{"map-options":"",outlined:"",dense:"",clearable:"",options:t.stopsOutOptions,label:"To","content-class":"bg-dark",dark:"","use-input":"","emit-value":"","input-debounce":"0"},on:{filter:t.stopOutFilter},model:{value:t.booking.out.stopId,callback:function(e){t.$set(t.booking.out,"stopId",e)},expression:"booking.out.stopId"}}),t.stopOutInfo?s("div",[s("p",[t._v(t._s(t.stopOutInfo.cost))])]):t._e()],1),s("q-tab-panel",{staticClass:"bg-secondar q-px-xs",attrs:{name:"ret"}},[s("h1",{staticClass:"q-mx-none q-pa-xs fullwidth bgx-grey-8"},[t._v("From")]),s("q-select",{ref:"stopRet",attrs:{"map-options":"",outlined:"",dense:"",clearable:"",options:t.stopsRetOptions,label:"From","content-class":"bg-dark",dark:"","use-input":"","emit-value":"","input-debounce":"0"},on:{filter:t.stopRetFilter},model:{value:t.booking.ret.stopId,callback:function(e){t.$set(t.booking.ret,"stopId",e)},expression:"booking.ret.stopId"}})],1)],1),s("div",[s("div",{staticClass:"row q-mt-md full-width"},[s("q-btn",{staticClass:"text-primary col",attrs:{disabled:!t.showBottomButtons,size:"large",outlinex:"",xflat:"",color:"primary","text-color":"black",dark:"",icon:"fal fa-check",label:t.isEdit?"Save Changes":"Submit Booking"},nativeOn:{click:function(e){return t.submit(e)}}})],1)])],1)},h=[],g=(s("ce9c"),s("8b05")),f={name:"TBSCoachBookingNew",props:{bookingToEdit:{type:Object},id:{type:Number},channel:{type:String,default:""}},data:function(){return{dark:!0,isEdit:!1,isOutOnly:!1,isRetOnly:!1,hasSubmitted:!1,pupilNames:[],pupilOptions:[],journeyTab:"out",selectedPupil:null,pupilHouse:null,pupilEmail:null,stopsOutOptions:[],stopsRetOptions:[],stops:{out:[],ret:[]},booking:{id:null,pupilId:null,sessionId:null,out:{stopId:null},ret:{stopId:null}}}},methods:{submit:function(){var t=this;this.showBottomButtons&&(this.hasSubmitted=!0,this.$q.loading.show(),this.isEdit?u.putBooking((function(){t.$q.notify("Submitted"),t.$q.loading.hide(),t.$emit("saved")}),(function(){t.$q.notify("Sad Face :("),t.$q.loading.hide()}),this.booking):u.postBooking((function(){t.$q.notify("Submitted"),t.$q.loading.hide(),t.$emit("saved")}),(function(){t.$q.notify("Sad Face :("),t.$q.loading.hide()}),this.booking))},pupilDetails:function(t){var e=this;this.booking.pupilId=t.value,g["a"].getDetails((function(t){e.pupilHouse=t.boardingHouse,e.pupilEmail=t.email}),null,{id:t.value})},getStudents:function(){var t=this;g["a"].getNames((function(e){if(t.pupilNames=e.map((function(t){return{value:t.id,label:t.lastname+", "+t.firstname,sublabel:"Millmead"}})),t.bookingToEdit){var s=t.pupilNames.find((function(e){return e.value===t.bookingToEdit.studentId}));t.selectedPupil=t.bookingToEdit?s:null,t.pupilDetails(s)}}))},stopOutFilter:function(t,e){var s=this;e(""!==t?function(){var e=t.toLowerCase();s.stopsOutOptions=s.stopsOut.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}:function(){s.stopsOutOptions=s.stopsOut})},stopRetFilter:function(t,e){var s=this;e(""!==t?function(){var e=t.toLowerCase();s.stopsRetOptions=s.stopsRet.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}:function(){s.stopsRetOptions=s.stopsRet})},pupilFilter:function(t,e){var s=this;e(""!==t?function(){var e=t.toLowerCase();s.pupilOptions=s.pupilNames.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}:function(){s.pupilOptions=s.pupilNames})},pickupFilter:function(t,e){var s=this;e(""!==t?function(){var e=t.toLowerCase();s.pickupOptions=s.pickupOptions.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}:function(){s.pickupOptions=s.pickupLocations})},mergeJourney:function(t,e){t.stopId=e.stopId},getStops:function(){var t=this;d["a"].getStops((function(e){t.stops=e}),null,this.booking.sessionId)}},computed:{stopOutInfo:function(){var t=this,e=this.stops.out.find((function(e){return e.id===t.booking.out.stopId}));return e},stopRetInfo:function(){var t=this;return this.stops.ret.find((function(e){return e.id===t.booking.ret.stopId}))},showBottomButtons:function(){return!!this.selectedPupil&&(this.isEdit||this.booking.out.stopId||this.booking.ret.stopId)},stopsOut:function(){return 0===this.stops.length?[]:this.stops.out.map((function(t){return{value:t.id,label:t.name}}))},stopsRet:function(){return 0===this.stops.length?[]:this.stops.ret.map((function(t){return{value:t.id,label:t.name}}))}},watch:{},components:{},created:function(){if(this.bookingToEdit){var t=this.bookingToEdit;this.isEdit=!0,this.booking.sessionId=t.sessionId,this.booking.id=t.id,t.isReturn?(this.isRetOnly=!0,this.mergeJourney(this.booking.ret,t),this.journeyTab="ret"):(this.isOutOnly=!0,this.mergeJourney(this.booking.out,t))}this.getStudents(),this.booking.sessionId=this.$store.getters["transport/activeSession"],this.getStops()}},b=f,m=(s("3bde"),s("2be6")),v=Object(m["a"])(b,p,h,!1,null,"47311d07",null),k=v.exports,q=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"q-pa-xs q-my-sm"},[s("q-expansion-item",{staticClass:"text-white bg-grey-9",attrs:{group:t.group,dense:""},scopedSlots:t._u([{key:"header",fn:function(){return[1===t.status?s("q-item-section",{staticClass:"flex",attrs:{avatar:""}},[0===t.booking.isReturn?s("q-icon",{attrs:{color:"white",name:"fal fa-arrow-square-right"}}):t._e(),1===t.booking.isReturn?s("q-icon",{attrs:{name:"fal fa-arrow-square-left",color:"primary"}}):t._e()],1):t._e(),1===t.status?s("q-item-section",[s("q-item-label",[s("div",{staticClass:"row fullwidth"},[t._v("\n            "+t._s(t.booking.displayName)+"\n            "),0===t.booking.isReturn?s("q-icon",{staticClass:"q-mx-md",attrs:{name:"fal fa-arrow-right"}}):t._e(),1===t.booking.isReturn?s("q-icon",{staticClass:"q-mx-md",attrs:{name:"fal fa-arrow-left"}}):t._e(),t._v("\n            "+t._s(t.booking.stop)+"\n          ")],1)])],1):t._e(),t.status>1?s("q-item-section",[s("q-item-label",[s("div",{staticClass:"row fullwidth"},[t._v("\n            "+t._s(t.booking.displayName)+"\n          ")])]),t.booking.statusId>1?s("q-item-label",{staticClass:"text-white",attrs:{caption:""}},[s("div",{staticClass:"row"},[t._v("\n            "+t._s(t.booking.stop)+"\n            "),0===t.booking.isReturn?s("q-icon",{staticClass:"q-mx-md",attrs:{name:"fal fa-arrow-right"}}):t._e(),1===t.booking.isReturn?s("q-icon",{staticClass:"q-mx-md",attrs:{name:"fal fa-arrow-left"}}):t._e()],1)]):t._e()],1):t._e(),s("q-item-section",{attrs:{side:""}},[s("div",{staticClass:"row text-positive"},[t._v("\n          "+t._s(t.booking.coachCode)+"\n          "),t.booking.statusId<4?s("select-button",{staticClass:"q-ml-sm",staticStyle:{"max-width":"20px"},attrs:{size:"xs",icon:"fal fa-bus",title:t.booking.stop,success:t.saveCoach,model:t.booking,field:"coachId",options:t.availiableCoaches,fieldLabel:"Select Coach",color:"positive","text-color":"black"}}):t._e()],1)])]},proxy:!0}])},[s("q-item-section",{staticClass:"bg-grey-9 booking-details"},[s("q-item-label",{staticClass:"q-ml-md q-mt-md"},[s("q-badge",{staticClass:"q-mr-xs label",attrs:{color:"grey-7","text-color":"white",label:"Ref"}}),t._v("\n        "+t._s(t.booking.id)+"\n      ")],1),s("q-item-label",{staticClass:"q-ml-md q-mt-md"},[s("q-badge",{staticClass:"q-mr-xs label",attrs:{color:"grey-7","text-color":"white",label:"Route"}}),t._v("\n        "+t._s(t.route.name)+"\n      ")],1),s("q-item-label",{staticClass:"q-ml-md q-mt-md"},[s("q-badge",{staticClass:"q-mr-xs label",attrs:{color:"grey-7","text-color":"white",label:"Stop"}}),t._v("\n        "+t._s(t.stop.name)+"\n      ")],1),t.status>1?s("q-item-label",{staticClass:"q-ml-md q-mt-md"},[s("q-badge",{staticClass:"q-mr-xs label",attrs:{color:0===t.booking.cost?"red":"grey-7","text-color":"white"}},[t._v("\n        Price\n        "),0===t.booking.cost?s("q-icon",{staticClass:"q-ml-xs",attrs:{name:"warning",size:"14px"}}):t._e()],1),t._v("\n        £"+t._s(t.booking.cost)+"\n      ")],1):t._e(),t.status>1?s("q-item-label",{staticClass:"q-ml-md q-mt-md"},[s("q-badge",{staticClass:"q-mr-xs  label",attrs:{color:"grey-4","text-color":"black",label:"Coach"}}),t._v("\n        "+t._s(t.booking.coachCode)+"\n        "),s("select-button",{staticClass:"q-ml-sm",attrs:{size:"sm",icon:"fal fa-bus",title:t.booking.stop,success:t.saveCoach,model:t.booking,field:"coachId",options:t.availiableCoaches,fieldLabel:"Select Coach",color:"positive","text-color":"black"}})],1):t._e(),s("q-item-label",{staticClass:"q-mt-sm"},[4!==t.booking.statusId?s("q-bar",{staticClass:"q-mt-md bg-grey-9 row",attrs:{dense:""}},[s("confirm-button",{attrs:{label:"can",color:"deep-orange-13",title:"Cancel Booking?",success:t.cancelBooking,"text-color":"black",icon:"fal fa-minus"}}),s("confirm-button",{attrs:{label:"decline",color:"blue-4",title:"Decline Booking?",success:t.declineBooking,"text-color":"black",icon:"fal fa-heart-broken"}}),s("q-btn",{staticClass:"col",attrs:{dense:"",left:"",icon:"fal fa-edit",color:"grey-4","text-color":"black",label:"edit",size:"xs"},on:{click:function(e){return t.editBooking()}}}),1===t.status?s("select-button",{staticClass:"q-ml-sm",attrs:{size:"xs",icon:"fal fa-bus",title:t.booking.stop,success:t.saveCoach,model:t.booking,field:"coachId",options:t.availiableCoaches,fieldLabel:"Select Coach",color:"positive","text-color":"black",label:"assign"}}):t._e(),2===t.status||3===t.status?s("q-btn",{staticClass:"col",attrs:{disabled:!t.booking.cost>0,dense:"",icon:"fal fa-envelope",color:"positive","text-color":"black",size:"xs",label:"confirm"}},[0===t.booking.cost?s("q-tooltip",{attrs:{"content-class":"bg-positive text-black",offset:[10,10]}},[t._v("\n              Set the price to confirm!\n            ")]):t._e(),t.booking.cost>0?s("q-popup-proxy",[s("q-card",{staticClass:"bg-blue-grey-7",attrs:{dark:""}},[s("q-card-section",[s("div",[t._v("Send Confirmation Email(s)?")])]),s("q-separator",{attrs:{dark:"",inset:""}}),s("q-card-section",{},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"full-width",attrs:{color:"pink",label:"Confirm"},on:{click:function(e){return t.confirmBooking()}}})],1)],1)],1):t._e()],1):t._e()],1):t._e()],1)],1)],1),s("q-dialog",{ref:"new",attrs:{"content-classes":"new-modal bg-dark q-pa-md",persistent:"","transition-show":"scale","transition-hide":"scale"},model:{value:t.showEditForm,callback:function(e){t.showEditForm=e},expression:"showEditForm"}},[s("q-card",{staticClass:"bg-grey-9",attrs:{dark:""}},[s("q-toolbar",[s("q-toolbar-title",[t._v("Edit Booking "+t._s(t.booking.id))]),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",round:"",dense:"",icon:"close"}})],1),s("q-card-section",[s("booking",{key:t.booking.id,attrs:{id:t.booking.id,bookingToEdit:t.booking,channel:"tbs.coaches.bookings"},on:{close:function(e){t.showEditForm=!1},saved:t.emit}})],1)],1)],1)],1)},x=[],C=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-btn",{staticClass:"col",attrs:{size:t.size,icon:t.icon,outline:t.outline,dense:"","text-color":t.textColor,color:t.color,label:t.label},on:{click:function(t){t.stopPropagation()}}},[t.tooltip?s("q-tooltip",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[t._v("\n     "+t._s(t.tooltip)+"\n   ")]):t._e(),s("q-popup-proxy",{ref:"popup",attrs:{persistent:""}},[s("q-card",{staticClass:"bg-blue-grey-9",attrs:{dark:""}},[s("q-card-section",[t._v("\n        "+t._s(t.title)+"\n      ")]),s("q-separator",{attrs:{dark:"",inset:""}}),s("q-card-section",{},[s("q-select",{attrs:{"emit-value":"","map-options":"",dark:"",filled:"",options:t.options,fieldLabel:t.label},model:{value:t.model[t.field],callback:function(e){t.$set(t.model,t.field,e)},expression:"model[field]"}}),s("br"),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"full-width",attrs:{"text-color":"black",color:"positive",disabled:!t.model[t.field],label:t.buttonLabel},on:{click:function(e){return t.success(t.model)}}})],1)],1)],1)],1)},y=[],w={name:"Component.Buttons.New",props:{success:{type:Function,required:!0},model:{type:Object,required:!0},options:{type:Array,required:!0},field:{type:String,required:!0},size:{type:String,default:"xs"},icon:{type:String,default:"fal fa-edit"},title:{type:String,default:""},fieldLabel:{type:String,default:""},type:{type:String,default:""},tooltip:{type:String},color:{type:String,default:"primary"},label:{type:String,default:""},buttonLabel:{type:String,default:"Save"},textColor:{type:String,default:""},outline:{type:Boolean}},data:function(){return{}},methods:{},computed:{},components:{},created:function(){}},_=w,S=(s("e571"),Object(m["a"])(_,C,y,!1,null,"979a5a50",null)),O=S.exports,B=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-btn",{staticClass:"col",attrs:{size:t.size,icon:t.icon,color:t.color,outline:t.outline,dense:"","text-color":t.textColor,label:t.label},on:{click:function(t){t.stopPropagation()}}},[t.tooltip?s("q-tooltip",{attrs:{"transition-show":"scale","transition-hide":"scale"}},[t._v("\n     "+t._s(t.tooltip)+"\n   ")]):t._e(),s("q-popup-proxy",[s("q-card",{staticClass:"bg-blue-grey-9",staticStyle:{width:"200px"},attrs:{dark:""}},[s("q-card-section",[t._v("\n        "+t._s(t.title)+"\n      ")]),s("q-separator",{attrs:{dark:"",inset:""}}),s("q-card-section",{staticClass:"row q-gutter-sm"},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"col",attrs:{color:"pink",label:t.buttonLabelNo}}),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"col",attrs:{color:"positive","text-color":"black",label:t.buttonLabelYes},on:{click:function(e){return t.success(t.model)}}})],1)],1)],1)],1)},I=[],R={name:"Component.Buttons.New",props:{success:{type:Function,required:!0},model:{type:Object,default:function(){}},size:{type:String,default:"xs"},icon:{type:String,default:"fal fa-edit"},title:{type:String,default:""},fieldLabel:{type:String,default:""},type:{type:String,default:""},tooltip:{type:String},color:{type:String,default:"primary"},label:{type:String,default:""},buttonLabelYes:{type:String,default:"Yes"},buttonLabelNo:{type:String,default:"No"},textColor:{type:String,default:""},outline:{type:Boolean}},data:function(){return{}},methods:{},computed:{},components:{},created:function(){}},E=R,D=(s("4017"),Object(m["a"])(E,B,I,!1,null,"2e09cc3a",null)),$=D.exports,N={name:"CoachBookingCard",props:{booking:{type:Object,required:!0},stops:{type:Object,required:!0},routes:{type:Array,required:!0},group:{type:String,required:!0}},data:function(){return{showEditForm:!1,bookingId:null,currentBooking:null}},methods:{saveCoach:function(){u.putCoachAssignment(this.emit,null,this.booking)},confirmBooking:function(){u.putConfirmBooking(this.emit,null,this.booking)},cancelBooking:function(){u.deleteBooking(this.emit,null,this.booking.id)},declineBooking:function(){u.declineBooking(this.emit,null,this.booking.id)},editBooking:function(){this.currentBookingId=this.booking.id,this.showEditForm=!0,this.currentBooking=this.booking},emit:function(){this.showEditForm=!1,this.$emit("change")}},computed:{status:function(){return this.booking.statusId},taxiCompanyName:function(){var t=this.booking.taxiId,e=this.taxiCompanies.find((function(e){return e.value===t}));return e?e.label:"ERROR"},route:function(){var t=this.booking.routeId,e=this.routes.find((function(e){return e.id===t}));return e||"ERROR"},stop:function(){var t=this.booking.stopId,e=1===this.booking.isReturn?this.stops.ret:this.stops.out;if(!e)return{};var s=e.find((function(e){return e.id===t}));return s||!1},availiableCoaches:function(){return this.stop?this.stop.coaches.map((function(t){return{value:t.id,label:t.code+" ["+t.spacesLeft+" spaces]"}})):[]}},components:{Booking:k,SelectButton:O,ConfirmButton:$},created:function(){}},L=N,T=(s("63c7"),Object(m["a"])(L,q,x,!1,null,"70817c84",null)),z=T.exports,F={name:"Coaches.Home",props:{},data:function(){return{rawBookings:[],stops:{},routes:[],search:"",showEditForm:!1,currentBookingId:null,currentBooking:null,session:null}},methods:{getBookings:function(){var t=this;console.warn("bks"),this.getStops(),this.getRoutes(),u.getAllBookings((function(e){t.rawBookings=e}),null)},getStops:function(){var t=this;d["a"].getStops((function(e){t.stops=e}),this.$error,this.session)},getRoutes:function(){var t=this;d["a"].getRoutes((function(e){t.routes=e}),this.$error,this.session)},initialise:function(){var t=this.$store.getters["transport/activeSession"];this.session=t,t&&this.$wampSubscribe("coaches"+t,this.getBookings),this.getBookings()}},computed:{bookings:function(){var t=this.search;return""===t?this.rawBookings:this.rawBookings.filter((function(e){return e.displayFrom.toLowerCase().indexOf(t)>-1||e.displayTo.toLowerCase().indexOf(t)>-1||e.displayName.toLowerCase().indexOf(t)>-1}))},newBookings:function(){return this.bookings.filter((function(t){return 1===t.statusId}))},pendingBookings:function(){return this.bookings.filter((function(t){return 2===t.statusId}))},confirmedBookings:function(){return this.bookings.filter((function(t){return 3===t.statusId}))},cancelledBookings:function(){return this.bookings.filter((function(t){return 4===t.statusId}))},declinedBookings:function(){return this.bookings.filter((function(t){return 5===t.statusId}))}},components:{Booking:k,BookingCard:z,ConfirmButton:$},created:function(){var t=this;this.$store.watch((function(){return t.$store.getters["transport/activeSession"]}),this.getBookings),this.initialise()}},j=F,A=(s("bd0e"),Object(m["a"])(j,a,r,!1,null,"ab464618",null)),P=A.exports,W=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row no-wrap q-px-md q-pt-md text-left"},[s("div",{staticClass:"q-mr-md",staticStyle:{"min-width":"200px"}},[s("q-scroll-area",{staticStyle:{height:"80vh"}},[s("q-list",{staticClass:"no-padding",attrs:{bordered:""}},t._l(t.routeOptions,(function(e){return s("q-item",{key:e.value,staticClass:"q-pa-xs text-white bgx-grey-8 bg-toolbar q-my-xs",class:e.value===t.selectedRouteId?"active-route":"",staticStyle:{border:"1px solid grey"},attrs:{clickable:"",group:"routes",dense:"","expand-separatorx":""},on:{click:function(s){return t.setRoute(e.value)}}},[s("q-item-section",{attrs:{top:""}},[s("q-item-label",{staticClass:"row"},[s("div",{staticClass:"col text-h7 text-bold text-primary q-mt-xs"},[s("span",{staticClass:"q-mr-md"},[t._v(t._s(e.label))])])])],1),s("q-item-section",{attrs:{side:""}},[s("div",{staticClass:"row"},[e.supervisorAlert?s("q-icon",{staticClass:"col q-ml-xs",attrs:{size:"xs",name:"fal fa-user-graduate",color:"positive"}}):t._e(),e.alert?s("q-icon",{staticClass:"col q-ml-xs",attrs:{size:"xs",name:"fal fa-exclamation-circle",color:"positive"}}):t._e()],1)])],1)})),1)],1)],1),s("div",{staticClass:"col"},[s("div",{staticClass:"row q-ml-md"},t._l(t.selectedRoute.stops,(function(e){return 0===e.isSchoolLocation?s("q-btn",{key:e.id,staticClass:"q-mr-xs",attrs:{color:e.color,label:e.name,size:"sm",densex:""}}):t._e()})),1),s("div",{staticClass:"row"},[s("q-scroll-area",{staticClass:"col row",staticStyle:{height:"70vh"},attrs:{horizontal:"",visible:"","bar-style":{background:"grey"},"thumb-style":{background:"white",opacity:1}}},[s("div",{staticClass:"row no-wrap"},t._l(t.selectedRoute.coaches,(function(e){return s("coach",{key:e.id,staticClass:"col",attrs:{coach:e,stops:t.selectedRoute.stops},on:{change:t.getRoutes}})})),1)]),s("unassigned",{attrs:{bookings:t.unassignedBookings,stops:t.selectedRoute.stops},on:{change:t.getRoutes}})],1)])])},H=[],U=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"q-ma-md"},[s("q-bar",{staticClass:"text-white bg-toolbar q-mb-xs",staticStyle:{overflow:"hidden","text-overflow":"ellipses","white-space":"nowrap"},style:{width:t.containerWidth+"px",minWidth:t.containerWidth+"px"}},[t._v("\n      "+t._s(t.coach.code)+"\n      "),s("q-space"),t.coach.alert?s("q-icon",{staticClass:"q-ml-xs",attrs:{size:"xs",name:"fal fa-exclamation-circle",color:"positive"}}):t._e()],1),s("q-bar",{staticClass:"text-white bg-toolbar q-mb-xs q-pr-xs row",style:{width:t.containerWidth+"px",minWidth:t.containerWidth+"px"}},[s("q-btn",{staticClass:"q-mr-sm",attrs:{icon:"fal fa-user-graduate",dense:"",size:"xs","text-color":"primary",flat:""}},[s("q-popup-proxy",{ref:"sup"},[s("q-banner",{staticClass:"bg-dark",staticStyle:{border:"1px solid grey"},scopedSlots:t._u([{key:"avatar",fn:function(){return[s("q-icon",{attrs:{size:"sm",name:"fal fa-user-graduate",color:"primary"}})]},proxy:!0}])},[s("div",{staticClass:"row"},[s("users",{ref:"users",attrs:{label:"Supervisor",id:t.coach.supervisorId},on:{change:t.saveSupervisor}})],1)])],1)],1),s("span",{staticClass:"col",staticStyle:{"font-size":"12px",overflow:"hidden","text-overflow":"ellipses","white-space":"nowrap"}},[t._v(t._s(t.coach.supervisor.displayName))])],1),s("q-bar",{staticClass:"text-white bg-toolbar q-mb-xs",staticStyle:{height:"20px"}},t._l(t.coach.stops,(function(e){return 0===e.isSchoolLocation&&e.isActive?s("q-badge",{key:e.id,staticStyle:{height:"5px"},attrs:{icon:"far fa-plus",color:t.stopColor(e.id)}}):t._e()})),1),s("div",{directives:[{name:"mutation",rawName:"v-mutation",value:t.handler,expression:"handler"}],staticClass:"drop-target rounded-borders overflow-hidden bg-toolbar",style:{height:t.containerHeight+"px",width:t.containerWidth+"px",minWidth:t.containerWidth+"px"},attrs:{id:"coach_"+t.coach.id},on:{dragenter:t.onDragEnter,dragleave:t.onDragLeave,dragover:t.onDragOver,drop:t.onDrop}},[t._l(t.noSeats,(function(e){return s("div",{key:e,staticClass:"box bg-dark",staticStyle:{border:"none"},style:{height:t.boxDims+"px",width:t.boxDims+"px"},attrs:{id:"protected",protected:"true"}})})),t._l(t.coach.bookings,(function(e){return s("div",{key:e.id,staticClass:"box border-toolbar",class:"bg-"+t.stopColor(e.stopId),style:{height:t.boxDims+"px",width:t.boxDims+"px"},attrs:{id:e.id,draggable:"true"},on:{dragstart:t.onDragStart}})}))],2)],1)},J=[],M=(s("6a7b"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"q-pa-md"},[s("div",{staticClass:"q-gutter-md row"},[s("q-select",{staticStyle:{"min-width":"300px"},attrs:{filled:"",dense:"",dark:"","use-input":"","input-debounce":"0",label:t.label,options:t.selectOptions},on:{filter:t.filterFn},scopedSlots:t._u([{key:"no-option",fn:function(){return[s("q-item",[s("q-item-section",{staticClass:"text-grey"},[t._v("\n            No Users\n          ")])],1)]},proxy:!0}]),model:{value:t.user,callback:function(e){t.user=e},expression:"user"}})],1)])}),Y=[],G={getUserNames:function(t,e){l["a"].get("/users/names").then((function(e){t(e.data)})).catch((function(t){console.log(t)}))},getUser:function(t,e,s){l["a"].get("/users/details/"+s).then((function(e){t(e.data)})).catch((function(t){console.log(t)}))}},K={name:"Component.Dropdowns.Users",props:{options:{type:Array,default:function(){return[]}},id:{default:null},label:{default:"Common Room",type:String}},data:function(){return{users:[],filter:null,userOptions:[],user:{},details:{},noEmit:!1,selectOptions:[]}},methods:{process:function(t){var e=this;this.users=t,this.userOptions=t.map((function(t){return{value:t.id,label:t.displayName,firstName:t.firstname,lastName:t.lastname}})),this.selectOptions=this.userOptions,this.id&&(this.noEmit=!0,this.user=this.userOptions.find((function(t){return t.value===e.id})))},filterFn:function(t,e){var s=this;e(""!==t?function(){var e=t.toLowerCase();s.selectOptions=s.userOptions.filter((function(t){return t.label.toLowerCase().indexOf(e)>-1}))}:function(){s.selectOptions=s.userOptions})},emit:function(t){this.noEmit?this.noEmit=!1:(this.details=t,this.$emit("change",t))}},computed:{},watch:{user:function(){G.getUser(this.emit,null,this.user.value)}},components:{},created:function(){G.getUserNames(this.process),this.options.length>0&&(this.selectOptions=this.options)}},Q=K,V=(s("8209"),Object(m["a"])(Q,M,Y,!1,null,"b037fe10",null)),X=V.exports,Z={props:{coach:{type:Object,required:!0},stops:{type:Array,required:!0}},data:function(){return{status:[],boxDims:50,columns:4}},methods:{emit:function(){this.$emit("change")},assignCoach:function(t){var e={id:t,coachId:this.coach.id};u.putCoachAssignment(this.emit,null,e)},saveSupervisor:function(t){var e=this;d["a"].putSupervisor((function(){e.$refs.sup.hide(),e.coach.supervisor=t,e.emit()}),this.$error,this.coach.id,t.id)},stopColor:function(t){var e=this.stops.find((function(e){return e.id===t}));return e.color},handler:function(t){for(var e in this.status1=[],t){var s=t[e];this.status.push(s)}},onDragStart:function(t){var e=t.target.id,s=this.coach.bookings.find((function(t){return t.id===parseInt(e)}));t.dataTransfer.setData("bookingId",e),t.dataTransfer.setData("stopId",s.stopId),t.dataTransfer.dropEffect="move"},onDragEnter:function(t){!0!==t.target.draggable&&"protected"!==t.target.id&&t.target.classList.add("drag-enter")},onDragLeave:function(t){t.target.classList.remove("drag-enter")},onDragOver:function(t){t.preventDefault()},onDrop:function(t){t.preventDefault();var e=t.target;!0!==t.target.draggable&&"protected"!==t.target.id||(e=document.getElementById("coach_"+this.coach.id));var s=t.dataTransfer.getData("bookingId"),o=parseInt(t.dataTransfer.getData("stopId")),i=document.getElementById(s);if(i.parentNode!==t.target){var n=this.coach.stops.find((function(t){return t.id===o&&t.isActive}));n&&(i.parentNode.removeChild(i),e.appendChild(i),this.assignCoach(s)),e.classList.remove("drag-enter")}else t.target.classList.remove("drag-enter")}},computed:{size:function(){return this.coach.capacity},bookings:function(){return[{id:1},{id:2}]},containerWidth:function(){return 4*this.boxDims},containerHeight:function(){var t=Math.floor(this.size/this.columns)+1;return t*this.boxDims},noSeats:function(){var t=this.size%this.columns;return t},supervisorEmail:function(){return""}},components:{Users:X}},tt=Z,et=(s("00ed"),Object(m["a"])(tt,U,J,!1,null,"46c3c5d8",null)),st=et.exports,ot=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"q-ma-md q-pl-sm",staticStyle:{"border-left":"1px solid grey"}},[s("q-bar",{staticClass:"text-white bg-toolbar q-mb-xs"},[t._v("Unassigned")]),s("div",{directives:[{name:"mutation",rawName:"v-mutation",value:t.handler,expression:"handler"}],staticClass:"drop-target rounded-borders overflow-hidden bg-toolbar q-mt-xs",style:{height:t.containerHeight+"px",width:t.containerWidth+"px",minWidth:t.containerWidth+"px"},attrs:{id:"unassigned"},on:{dragenter:t.onDragEnter,dragleave:t.onDragLeave,dragover:t.onDragOver,drop:t.onDrop}},t._l(t.bookings,(function(e){return s("div",{key:e.id,staticClass:"box border-toolbar",class:"bg-"+t.stopColor(e.stopId),style:{height:t.boxDims+"px",width:t.boxDims+"px"},attrs:{id:e.id,draggable:"true"},on:{dragstart:t.onDragStart}})})),0)],1)},it=[],nt={props:{bookings:{type:Array,required:!0},stops:{type:Array,required:!0}},data:function(){return{status:[],boxDims:50,columns:4}},methods:{emit:function(){this.$emit("change")},assignCoach:function(t){var e={id:t,coachId:0};u.putCoachAssignment(this.emit,null,e)},stopColor:function(t){var e=this.stops.find((function(e){return e.id===t}));return e.color},handler:function(t){for(var e in this.status1=[],t){var s=t[e];this.status.push(s)}},onDragStart:function(t){var e=t.target.id,s=this.bookings.find((function(t){return t.id===parseInt(e)}));t.dataTransfer.setData("bookingId",e),t.dataTransfer.setData("stopId",s.stopId),t.dataTransfer.dropEffect="move"},onDragEnter:function(t){!0!==t.target.draggable&&"protected"!==t.target.id&&t.target.classList.add("drag-enter")},onDragLeave:function(t){t.target.classList.remove("drag-enter")},onDragOver:function(t){t.preventDefault()},onDrop:function(t){t.preventDefault();var e=t.target;!0!==t.target.draggable&&"protected"!==t.target.id||(e=document.getElementById("coach_"+this.coach.id));var s=t.dataTransfer.getData("bookingId"),o=document.getElementById(s);o.parentNode!==t.target?(o.parentNode.removeChild(o),e.appendChild(o),e.classList.remove("drag-enter"),this.assignCoach(s)):t.target.classList.remove("drag-enter")}},computed:{size:function(){return this.bookings.length},containerWidth:function(){return 4*this.boxDims},containerHeight:function(){var t=Math.floor(this.size/this.columns)+1;return t*this.boxDims},noSeats:function(){var t=this.size%this.columns;return console.warn(t),t}}},at=nt,rt=(s("c1e0"),Object(m["a"])(at,ot,it,!1,null,"1115e645",null)),lt=rt.exports,ct={data:function(){return{routes:[],selectedRouteId:null,selectedRoute:{id:null,name:null},unassignedBookings:[],session:[]}},methods:{getRoutes:function(){d["a"].getRoutes(this.processRoutes,null,this.session)},processRoutes:function(t){this.routes=t,this.selectedRouteId?this.setRoute(this.selectedRouteId):this.setTopActive()},setTopActive:function(){var t=this.routes[0];this.selectedRouteId=t.id,this.setRoute(t.id)},setRoute:function(t){this.selectedRouteId=t,d["a"].getRoute(this.processRoute,this.$error,this.selectedRouteId)},processRoute:function(t){this.selectedRoute=t;var e=this;this.selectedRoute.stops.forEach((function(t,s,o){e.selectedRoute.stops[s].color=e.$palette(s)})),this.unassignedBookings=t.unassigned}},computed:{routesOut:function(){return this.routes.filter((function(t){return 0===t.isReturn}))},routeOptions:function(){return this.routes.map((function(t){return{value:t.id,label:t.name,alert:t.alert,supervisorAlert:t.supervisorAlert}}))}},created:function(){var t=this;0!==this.session&&(this.$store.watch((function(){return t.$store.getters["transport/activeSession"]}),this.setSession),this.session=this.$store.getters["transport/activeSession"]),this.getRoutes(),this.session=this.$store.getters["transport/activeSession"],this.$wampSubscribe("coaches"+this.session,this.getRoutes),this.$wampSubscribe("routes"+this.session,this.getRoutes)},components:{Coach:st,Unassigned:lt}},ut=ct,dt=(s("ec00"),Object(m["a"])(ut,W,H,!1,null,"6c96f708",null)),pt=dt.exports,ht=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"full-width",attrs:{stylex:"text-align:center; position: relative"}},[s("q-dialog",{ref:"new",attrs:{"content-classes":"new-modal bg-dark q-pa-md",persistent:"","transition-show":"scale","transition-hide":"scale"},on:{hide:t.close},model:{value:t.showForm,callback:function(e){t.showForm=e},expression:"showForm"}},[s("q-card",{staticClass:"bg-grey-9",attrs:{dark:""}},[s("q-toolbar",[s("q-icon",{attrs:{name:"fal fa-bus",size:"sm",color:""}}),s("q-toolbar-title",[t._v("New Booking")]),s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",round:"",dense:"",icon:"close"}})],1),s("q-card-section",[s("booking",{attrs:{channel:"tbs.coach.bookings"},on:{close:t.close,saved:t.close}})],1)],1)],1)],1)},gt=[],ft={name:"CoachBookingNewContainer",props:{},data:function(){return{showForm:!0}},methods:{close:function(){this.showEditForm=!1,this.$emit("close")}},computed:{},components:{Booking:k},created:function(){}},bt=ft,mt=(s("5c47"),Object(m["a"])(bt,ht,gt,!1,null,"ba89c440",null)),vt=mt.exports,kt=s("423b"),qt=s("0abc"),xt={name:"PageTransportCoaches",data:function(){return{elements:[{name:"home",component:P,icon:"fal fa-poll-people",shortcut:"b",count:0,tooltip:"Bookings Grid"},{name:"coaches",labelx:"coaches",component:pt,icon:"fal fa-bus",shortcut:"c",tooltip:"Set Coaches"},{name:"routes",labelx:"routes",icon:"fal fa-route",component:kt["a"],shortcut:"s",tooltip:"Route Settings"},{name:"new",labelx:"Overview",component:vt,icon:"fal fa-plus",shortcut:"c",tooltip:"New Booking"},{name:"portal",component:qt["a"],icon:"fal fa-poll-h",shortcut:"b",tooltip:"Portal Testing"}]}},components:{toolbarPage:n["a"]},methods:{newCount:function(){var t=this;u.getNewCount((function(e){var s=t.elements.find((function(t){return"home"===t.name}));s.count=e}),null)},counts:function(){var t=this.$store.getters["transport/activeSession"];this.$wampSubscribe("coaches"+t,this.newCount),this.newCount()}},created:function(){var t=this;this.counts(),this.$store.watch((function(){return t.$store.getters["transport/activeSession"]}),this.counts)}},Ct=xt,yt=Object(m["a"])(Ct,o,i,!1,null,null,null);e["default"]=yt.exports},e571:function(t,e,s){"use strict";var o=s("1853"),i=s.n(o);i.a},ec00:function(t,e,s){"use strict";var o=s("392f"),i=s.n(o);i.a}}]);